<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Venturi Meter Lab</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:        #f2f4f0;
  --surface:   #ffffff;
  --surface2:  #f7f8f6;
  --border:    #d4d9cf;
  --border-lt: #e2e6de;
  --text:      #1a211a;
  --text-md:   #4a5c4e;
  --text-lt:   #7a9080;
  --accent:    #2e7d32;
  --accent-h:  #1b5e20;
  --accent-bg: #e8f5e9;
  --c-static:  #1a4e8c;
  --c-dynamic: #bf360c;
  --c-total:   #263238;
  --cp1:       #1a4e8c;
  --cp2:       #b71c1c;
  --cp3:       #2e7d32;
  --ok:        #2e7d32;
  --ok-bg:     #e8f5e9;
  --err:       #b71c1c;
  --err-bg:    #fdecea;
  --ff:        'Inter', system-ui, sans-serif;
  --serif:     'Source Serif 4', Georgia, serif;
  --mono:      'JetBrains Mono', 'Courier New', monospace;
  --r:         8px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 18px; }
body {
  font-family: var(--serif);
  background: var(--bg);
  color: var(--text);
  line-height: 1.7;
  min-height: 100vh;
  -webkit-text-size-adjust: 100%;
}
.wizard { display: flex; flex-direction: column; height: 100dvh; }

/* TOP BAR */
.topbar {
  flex-shrink: 0;
  background: #263238;
  border-bottom: 4px solid var(--accent);
  padding: 18px 20px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}
.topbar-title {
  font-family: var(--ff);
  font-size: clamp(1.1rem, 4vw, 1.5rem);
  font-weight: 700;
  color: #ffffff;
  line-height: 1.2;
}
.topbar-sub {
  font-family: var(--serif);
  font-size: clamp(0.8rem, 3vw, 0.95rem);
  color: #90a4ae;
  font-style: italic;
  margin-top: 2px;
}
.steps-row {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}
.step-pip {
  cursor: pointer;
  width: 32px; height: 32px;
  border-radius: 50%;
  border: 2px solid #455a64;
  background: #37474f;
  color: #78909c;
  font-family: var(--ff);
  font-size: 0.8rem;
  font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.25s;
  flex-shrink: 0;
}
.step-pip.active { border-color: var(--accent); background: var(--accent); color: #fff; }
.step-pip.done   { border-color: var(--accent-h); background: var(--accent-bg); color: var(--accent); }
.step-connector  { width: 18px; height: 2px; background: #455a64; flex-shrink: 0; }

/* SLIDES */
.slides-viewport { flex: 1; position: relative; overflow: hidden; }
.slide {
  position: absolute; inset: 0;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 22px 20px 32px;
  opacity: 0;
  pointer-events: none;
  transform: translateX(48px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  will-change: opacity, transform;
}
.slide.active { opacity: 1; pointer-events: all; transform: translateX(0); }
.slide.exit   { opacity: 0; transform: translateX(-48px); }
.slide-body   { max-width: 800px; margin: 0 auto; }

/* HEADINGS */
.slide-h {
  font-family: var(--ff);
  font-size: 1.25rem;
  font-weight: 700;
  color: #263238;
  margin-bottom: 6px;
  line-height: 1.3;
}
.slide-lead {
  font-family: var(--serif);
  font-size: 1rem;
  color: var(--text-md);
  font-style: italic;
  margin-bottom: 22px;
  line-height: 1.7;
}

/* DIAGRAM */
.diagram-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 16px 18px 12px;
  margin-bottom: 14px;
}
.diagram-card svg { width: 100%; height: auto; display: block; }
.diagram-note {
  font-size: 0.8rem;
  color: var(--text-lt);
  font-style: italic;
  font-weight: 300;
  margin-top: 8px;
  line-height: 1.5;
}

/* TRIAL CARDS */
.trial-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-left: 5px solid var(--border);
  border-radius: var(--r);
  padding: 18px 16px;
  margin-bottom: 14px;
  transition: border-left-color 0.2s;
}
.trial-card.complete { border-left-color: var(--ok); }
.trial-row-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
.trial-label {
  font-family: var(--ff);
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: 0.06em;
  text-transform: uppercase;
}
.btn-rm {
  background: transparent;
  color: #b71c1c;
  border: 1px solid #b71c1c;
  padding: 7px 14px;
  border-radius: 5px;
  cursor: pointer;
  font-family: var(--ff);
  font-size: 0.82rem;
  font-weight: 600;
  min-height: 40px;
  transition: background 0.15s;
}
.btn-rm:hover { background: #fdecea; }
.fields-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
@media (max-width: 500px) { .fields-grid { grid-template-columns: 1fr 1fr; gap: 10px; } }
.fld label {
  display: block;
  font-family: var(--ff);
  font-size: 0.72rem;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  margin-bottom: 6px;
  font-weight: 700;
}
.fld.f-p1 label { color: var(--cp1); }
.fld.f-p2 label { color: var(--cp2); }
.fld.f-p3 label { color: var(--cp3); }
.fld.f-fl label { color: var(--text-md); }
.fld input {
  width: 100%;
  padding: 12px 13px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--surface2);
  color: var(--text);
  font-family: var(--mono);
  font-size: 1.1rem;
  min-height: 48px;
  transition: border-color 0.15s, box-shadow 0.15s;
  -webkit-appearance: none;
  appearance: none;
}
.fld input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(46,125,50,0.15);
  background: #fff;
}

/* BUTTONS */
.btn-add {
  font-family: var(--ff);
  font-size: 1rem;
  font-weight: 600;
  padding: 12px 24px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text-md);
  cursor: pointer;
  min-height: 48px;
  transition: border-color 0.15s, color 0.15s;
}
.btn-add:hover { border-color: var(--accent); color: var(--accent); }
.btn-proceed {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-family: var(--ff);
  font-size: 1rem;
  font-weight: 600;
  padding: 14px 28px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: var(--r);
  cursor: pointer;
  min-height: 50px;
  margin-top: 20px;
  transition: background 0.15s, opacity 0.15s;
}
.btn-proceed:hover:not(:disabled) { background: var(--accent-h); }
.btn-proceed:disabled { opacity: 0.35; cursor: not-allowed; }
.btn-proceed .arr { font-size: 1.1rem; }
.btn-back {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-family: var(--ff);
  font-size: 1rem;
  font-weight: 600;
  padding: 14px 24px;
  background: var(--surface);
  color: var(--text-md);
  border: 1px solid var(--border);
  border-radius: var(--r);
  cursor: pointer;
  min-height: 50px;
  transition: border-color 0.15s, color 0.15s;
}
.btn-back:hover { border-color: var(--accent); color: var(--accent); }
.btn-back .arr { font-size: 1.1rem; }

/* BERNOULLI BOX */
.bernoulli-box {
  background: var(--accent-bg);
  border-left: 5px solid var(--accent);
  border-radius: 0 var(--r) var(--r) 0;
  padding: 18px 20px;
  margin-bottom: 20px;
}
.bernoulli-eq {
  font-family: var(--mono);
  font-size: 1.05rem;
  font-weight: 500;
  margin-bottom: 8px;
  line-height: 1.5;
}
.bernoulli-eq .cs { color: var(--c-static);  font-weight: 700; }
.bernoulli-eq .cd { color: var(--c-dynamic); font-weight: 700; }
.bernoulli-eq .ct { color: var(--c-total);   font-weight: 700; }
.bernoulli-eq .cm { color: var(--text-md); }
.bernoulli-note { font-family: var(--serif); font-size: 0.95rem; color: #1b4020; line-height: 1.7; }

/* CHARTS */
.charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
@media (max-width: 600px) { .charts-grid { grid-template-columns: 1fr; } }
.chart-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 20px 16px;
}
.chart-card h3 { font-family: var(--ff); font-size: 1rem; font-weight: 700; color: #263238; margin-bottom: 6px; }
.chart-card .ch-note { font-family: var(--serif); font-size: 0.9rem; color: var(--text-md); line-height: 1.65; margin-bottom: 14px; }
.chart-sel-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.chart-sel-row label {
  font-family: var(--ff);
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-md);
}
.chart-sel-row select {
  font-family: var(--ff);
  font-size: 0.9rem;
  padding: 7px 10px;
  border: 1px solid var(--border);
  border-radius: 5px;
  background: var(--surface2);
  color: var(--text);
  min-height: 40px;
  -webkit-appearance: none;
  appearance: none;
}
.clr-legend { display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 10px; }
.clr-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: var(--text-md); }
.clr-swatch { width: 20px; height: 4px; border-radius: 2px; flex-shrink: 0; }

/* CFD UNITS */
.cfd-unit {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  margin-bottom: 24px;
}
.cfd-unit-header { padding: 16px 20px 12px; border-bottom: 1px solid var(--border-lt); }
.cfd-unit-header h3 { font-family: var(--ff); font-size: 1rem; font-weight: 700; color: #263238; margin-bottom: 4px; }
.cfd-unit-header p { font-family: var(--serif); font-size: 0.9rem; color: var(--text-md); font-style: italic; line-height: 1.65; }
.cfd-img-area { position: relative; background: #0C1824; overflow: hidden; }
.cfd-img-area img { width: 100%; display: block; position: relative; z-index: 1; }
.cfd-observe {
  padding: 14px 20px;
  background: var(--accent-bg);
  border-top: 1px solid #c8e6c9;
  font-family: var(--serif);
  font-size: 0.95rem;
  color: #1b4020;
  line-height: 1.7;
}
.cfd-observe strong { font-family: var(--ff); }
.cfd-question { padding: 18px 20px; border-top: 1px solid var(--border); }

/* QUESTION BADGES */
.q-badge {
  display: inline-block;
  font-family: var(--ff);
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  padding: 3px 9px;
  border-radius: 20px;
  margin-bottom: 10px;
  font-weight: 700;
}
.q-obs { background: #e3f2fd; color: #0d47a1; }
.q-exp { background: var(--accent-bg); color: #1b5e20; }
.q-prd { background: #fff8e1; color: #e65100; }
.q-stem { font-family: var(--ff); font-size: 1rem; font-weight: 700; color: #263238; margin-bottom: 8px; line-height: 1.45; }
.q-context {
  font-family: var(--serif);
  font-size: 0.95rem;
  color: var(--text-md);
  font-style: italic;
  line-height: 1.7;
  margin-bottom: 16px;
  padding-left: 14px;
  border-left: 4px solid var(--border);
}

/* MC OPTIONS */
.mc-opt {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 13px 15px;
  margin: 8px 0;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  font-family: var(--serif);
  font-size: 1rem;
  line-height: 1.55;
  transition: border-color 0.15s, background 0.15s;
  -webkit-tap-highlight-color: transparent;
  min-height: 48px;
}
.mc-opt:hover { border-color: var(--accent); background: var(--accent-bg); }
.mc-opt input { margin-top: 4px; flex-shrink: 0; accent-color: var(--accent); width: 18px; height: 18px; }
.mc-opt.locked { opacity: 0.6; cursor: default; pointer-events: none; }

/* FEEDBACK */
.q-feedback { display: none; margin-top: 14px; padding: 14px 16px; border-radius: 6px; font-family: var(--serif); font-size: 0.95rem; line-height: 1.7; }
.q-feedback.show { display: block; }
.fb-ok  { background: var(--ok-bg);  border-left: 5px solid var(--ok);  color: #1b4020; }
.fb-err { background: var(--err-bg); border-left: 5px solid var(--err); color: #5c0a0a; }

/* QUIZ META */
.quiz-meta { display: flex; align-items: center; justify-content: space-between; gap: 14px; margin-bottom: 22px; flex-wrap: wrap; }
.q-prog-label { font-family: var(--ff); font-size: 0.78rem; color: var(--text-lt); }
.q-prog-track { flex: 1; min-width: 100px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.q-prog-fill  { height: 100%; background: var(--ok); border-radius: 3px; transition: width 0.35s ease; }



/* UNDERSTANDING QUESTION UNITS */
.u-unit { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); overflow: hidden; margin-bottom: 16px; }
.u-unit-body { padding: 18px 20px; }
.u-stem { font-family: var(--ff); font-size: 1rem; font-weight: 700; color: #263238; margin-bottom: 6px; line-height: 1.45; }
.u-desc { font-family: var(--serif); font-size: 0.95rem; color: var(--text-md); line-height: 1.7; margin-bottom: 14px; }

/* ‚îÄ‚îÄ‚îÄ COMPLETION BANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.completion-banner {
  display: none;
  margin-top: 28px;
  padding: 28px 24px;
  background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
  border: 2px solid var(--accent);
  border-radius: var(--r);
  text-align: center;
}
.completion-banner.show { display: block; }
.completion-icon {
  font-size: 2.8rem;
  line-height: 1;
  margin-bottom: 12px;
}
.completion-title {
  font-family: var(--ff);
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--accent-h);
  margin-bottom: 8px;
}
.completion-msg {
  font-family: var(--serif);
  font-size: 1rem;
  color: #1b4020;
  line-height: 1.75;
  max-width: 540px;
  margin: 0 auto;
}
</style>
</head>
<body>
<div class="wizard">

  <header class="topbar">
    <div>
      <div class="topbar-title">Venturi Meter Lab</div>
      <div class="topbar-sub">Bernoulli's Principle ¬∑ Flow Measurement</div>
    </div>
    <div class="steps-row">
      <div class="step-pip active" id="sp1" onclick="goTo(1)">1</div>
      <div class="step-connector"></div>
      <div class="step-pip" id="sp2" onclick="goTo(2)">2</div>
      <div class="step-connector"></div>
      <div class="step-pip" id="sp3" onclick="goTo(3)">3</div>
      <div class="step-connector"></div>
      <div class="step-pip" id="sp4" onclick="goTo(4)">4</div>
    </div>
  </header>

  <div class="slides-viewport">

    <!-- ‚ïê‚ïê SLIDE 1 ‚Äî DATA ENTRY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="slide active" id="s1">
      <div class="slide-body">
        <div class="slide-h">Record your measurements</div>
        <div class="slide-lead">This can be completed individually. Enter piezometer heights and flow rate for each trial.</div>

        <div class="diagram-card">
          <svg viewBox="0 0 660 155" xmlns="http://www.w3.org/2000/svg">
            <rect width="660" height="155" fill="#FFFFFF"/>
            <line x1="15" y1="77" x2="645" y2="77" stroke="#E5E0D8" stroke-width="1" stroke-dasharray="5 4"/>
            <path d="M15,30 L160,30 Q235,30 272,63 L355,63 Q404,63 476,30 L645,30" stroke="#1E2A35" stroke-width="2.2" fill="none" stroke-linejoin="round"/>
            <path d="M15,124 L160,124 Q235,124 272,91 L355,91 Q404,124 476,124 L645,124" stroke="#1E2A35" stroke-width="2.2" fill="none" stroke-linejoin="round"/>
            <rect x="270" y="62" width="86" height="29" fill="rgba(201,91,59,0.08)" rx="1"/>
            <defs>
              <marker id="fl" markerWidth="7" markerHeight="7" refX="5" refY="3.5" orient="auto">
                <polygon points="0,0 7,3.5 0,7" fill="#2D6A9F"/>
              </marker>
            </defs>
            <line x1="22" y1="77" x2="58" y2="77" stroke="#2D6A9F" stroke-width="1.8" marker-end="url(#fl)"/>
            <text x="20" y="70" fill="#2D6A9F" font-size="9" font-weight="700" font-family="monospace">Q</text>
            <line x1="95" y1="30" x2="95" y2="8" stroke="#1A5276" stroke-width="1.5" stroke-dasharray="3 2"/>
            <circle cx="95" cy="30" r="4" fill="#1A5276"/>
            <text x="83" y="6" fill="#1A5276" font-size="10" font-weight="700" font-family="monospace">P‚ÇÅ</text>
            <line x1="95" y1="124" x2="95" y2="147" stroke="#1A5276" stroke-width="1.5" stroke-dasharray="3 2"/>
            <circle cx="95" cy="124" r="4" fill="#1A5276"/>
            <text x="70" y="154" fill="#1A5276" font-size="8" font-family="monospace">h‚ÇÅ Inlet</text>
            <line x1="313" y1="63" x2="313" y2="8" stroke="#922B21" stroke-width="1.5" stroke-dasharray="3 2"/>
            <circle cx="313" cy="63" r="4" fill="#922B21"/>
            <text x="301" y="6" fill="#922B21" font-size="10" font-weight="700" font-family="monospace">P‚ÇÇ</text>
            <line x1="313" y1="91" x2="313" y2="147" stroke="#922B21" stroke-width="1.5" stroke-dasharray="3 2"/>
            <circle cx="313" cy="91" r="4" fill="#922B21"/>
            <text x="281" y="154" fill="#922B21" font-size="8" font-family="monospace">h‚ÇÇ Throat</text>
            <line x1="540" y1="30" x2="540" y2="8" stroke="#196F3D" stroke-width="1.5" stroke-dasharray="3 2"/>
            <circle cx="540" cy="30" r="4" fill="#196F3D"/>
            <text x="528" y="6" fill="#196F3D" font-size="10" font-weight="700" font-family="monospace">P‚ÇÉ</text>
            <line x1="540" y1="124" x2="540" y2="147" stroke="#196F3D" stroke-width="1.5" stroke-dasharray="3 2"/>
            <circle cx="540" cy="124" r="4" fill="#196F3D"/>
            <text x="508" y="154" fill="#196F3D" font-size="8" font-family="monospace">h‚ÇÉ Outlet</text>
            <text x="17" y="80" fill="#9A9590" font-size="8" font-family="monospace">√ò 20 mm</text>
            <text x="285" y="80" fill="#922B21" font-size="8" font-family="monospace">√ò 10</text>
            <text x="578" y="80" fill="#9A9590" font-size="8" font-family="monospace">√ò 20 mm</text>
            <text x="172" y="144" fill="#B8B0A6" font-size="8" font-family="monospace">converging</text>
            <text x="372" y="144" fill="#B8B0A6" font-size="8" font-family="monospace">diverging (longer ‚Äî see Step 4)</text>
          </svg>
          <div class="diagram-note">Schematic representation of the venturi and tapping points.</div>
        </div>

        <div style="margin-bottom:14px; padding:12px 16px; background:var(--accent-bg); border-left:4px solid var(--accent); border-radius:0 6px 6px 0; font-family:var(--serif); font-size:0.95rem; color:#1b4020;">
          Note: Pressure can be measured in Pascal, mmH‚ÇÇO, atm, bar, etc. In this experiment we are using <strong>mmH‚ÇÇO</strong>.
        </div>

        <div id="trials-wrap"></div>
        <div style="margin-bottom:6px;">
          <button class="btn-add" onclick="addTrial()">+ Add trial</button>
        </div>
        <button class="btn-proceed" id="btn1" onclick="runAnalysis()" disabled>
          Move to analysis <span class="arr">‚Üí</span>
        </button>
      </div>
    </div><!-- /s1 -->

    <!-- ‚ïê‚ïê SLIDE 2 ‚Äî ANALYSIS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="slide" id="s2">
      <div class="slide-body">
        <div class="slide-h">Your results</div>
        <div class="slide-lead">Understanding the Bernoulli Principle</div>
        <p>Read the following theory and understand plot belows</p>
        <div class="bernoulli-box">
          <p style="font-family:var(--serif);font-size:0.95rem;color:#1b4020;margin-bottom:10px;">
            The Bernoulli equation for an ideal (inviscid, incompressible, steady) fluid is a conservation of energy expression:
          </p>
          <div class="bernoulli-eq">
            <span class="cs">P</span><span class="cm"> + </span><span class="cd">¬ΩœÅv¬≤</span><span class="cm"> + œÅgz </span><span class="ct">= constant</span>
          </div>
          <div class="bernoulli-note">
            <span style="color:var(--c-static);font-weight:700;">Static pressure</span> +
            <span style="color:var(--c-dynamic);font-weight:700;">Dynamic pressure</span> +
            Hydrostatic = Total &nbsp;¬∑&nbsp;
            Valid along a streamline in <em>steady, inviscid, incompressible</em> flow.
          </div>
        </div>

        <div class="bernoulli-box" style="margin-bottom:20px;">
          <p style="font-family:var(--serif);font-size:0.95rem;color:#1b4020;margin-bottom:10px;">
            Applying Bernoulli at points 1 and 2 of the venturi together with the continuity equation
            (<span style="font-family:var(--mono);font-size:0.9rem;">Q = A‚ÇÅv‚ÇÅ = A‚ÇÇv‚ÇÇ</span>),
            the expression for an ideal flow rate can be obtained as follows:
          </p>
          <div class="bernoulli-eq" style="font-size:1rem;line-height:1.8;">
            <span class="ct">Q<sub>ideal</sub></span><span class="cm"> = </span><span class="cs">A‚ÇÇ</span><span class="cm"> &times; </span><span class="cd">‚àö[ 2‚àÜP / œÅ(1 ‚àí (A‚ÇÇ/A‚ÇÅ)¬≤) ]</span>
          </div>
          <div class="bernoulli-note" style="margin-top:10px;">
            where <span style="font-family:var(--mono);font-size:0.88rem;">‚àÜP = P‚ÇÅ ‚àí P‚ÇÇ = œÅg(h‚ÇÅ ‚àí h‚ÇÇ)</span> is the pressure drop between inlet and throat (Pa),
            <span style="font-family:var(--mono);font-size:0.88rem;">A‚ÇÇ = 78.5 mm¬≤</span> is the throat area, and
            <span style="font-family:var(--mono);font-size:0.88rem;">A‚ÇÅ/A‚ÇÇ = 4</span>.
            The coefficient of discharge <span style="font-family:var(--mono);font-size:0.88rem;">C<sub>d</sub> = Q<sub>actual</sub> / Q<sub>ideal</sub></span>
            captures all real viscous losses not present in this ideal expression.
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-card">
            <h3>Pressure at each position</h3>
            <div class="clr-legend">
              <span class="clr-item"><span class="clr-swatch" style="background:var(--c-static)"></span>Static</span>
              <span class="clr-item"><span class="clr-swatch" style="background:var(--c-dynamic)"></span>Dynamic</span>
              <span class="clr-item"><span class="clr-swatch" style="border-top:2px dashed var(--c-total);background:transparent;"></span>Total</span>
            </div>
            <div class="ch-note">Select the test and observe static, dynamic and total pressure behaviour along the venturi.</div>
            <div class="chart-sel-row">
              <label>Trial:</label>
              <select id="trialSel" onchange="drawPressureChart()"></select>
            </div>
            <canvas id="pressureChart" height="210"></canvas>
          </div>
          <div class="chart-card">
            <h3>Actual vs theoretical flow rate</h3>
            <div class="ch-note">Light bar = Bernoulli ideal (no losses). Dark bar = your measurement. The gap is the Cd penalty ‚Äî energy consumed by friction and the boundary layer.</div>
            <canvas id="flowChart" height="210"></canvas>
          </div>
        </div>

        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:20px;">
          <button class="btn-back" onclick="goTo(1)"><span class="arr">‚Üê</span> Back</button>
          <button class="btn-proceed" style="margin-top:0;" onclick="goTo(3)">Move to understanding <span class="arr">‚Üí</span></button>
        </div>
      </div>
    </div><!-- /s2 -->

    <!-- ‚ïê‚ïê SLIDE 3 ‚Äî UNDERSTANDING (5 questions) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="slide" id="s3">
      <div class="slide-body">
        <div class="slide-h">Understanding</div>
        <div class="slide-lead">Five questions based on your experimental results and Bernoulli's principle.</div>

        <div class="quiz-meta">
          <span class="q-prog-label" id="uprog-lbl">0 of 5 answered</span>
          <div class="q-prog-track"><div class="q-prog-fill" id="uprog-fill" style="width:0%"></div></div>
        </div>

        <!-- U1 ‚Äî correct: C -->
        <div class="u-unit">
          <div class="u-unit-body">
            <span class="q-badge q-obs">Observe</span>
            <div class="u-stem">Q1 ‚Äî Total Pressure Behaviour</div>
            <div class="u-desc">Based on your experimental results, how did the total pressure behave along the Venturi tube from inlet to outlet?</div>
            <label class="mc-opt"><input type="radio" name="u1" value="A" onchange="checkU(1,'A')"> A &nbsp; The total pressure increased along the Venturi for most flow rates</label>
            <label class="mc-opt"><input type="radio" name="u1" value="B" onchange="checkU(1,'B')"> B &nbsp; I cannot draw a clear conclusion, possibly due to measurement errors or inconsistent readings</label>
            <label class="mc-opt"><input type="radio" name="u1" value="C" onchange="checkU(1,'C')"> C &nbsp; The total pressure decreased along the Venturi for most flow rates</label>
            <label class="mc-opt"><input type="radio" name="u1" value="D" onchange="checkU(1,'D')"> D &nbsp; The total pressure changed irregularly, with no consistent trend related to flow rate</label>
            <div id="uFb1" class="q-feedback"></div>
          </div>
        </div>

        <!-- U2 ‚Äî correct: D -->
        <div class="u-unit">
          <div class="u-unit-body">
            <span class="q-badge q-exp">Explain</span>
            <div class="u-stem">Q2 ‚Äî Dynamic Pressure Calculation</div>
            <div class="u-desc">In this experiment the static pressure is measured by reading the water column in the piezometer using Œîp = œÅgh. How is the dynamic pressure calculated?</div>
            <label class="mc-opt"><input type="radio" name="u2" value="A" onchange="checkU(2,'A')"> A &nbsp; It is not possible to calculate; we need a pitot tube to measure it directly</label>
            <label class="mc-opt"><input type="radio" name="u2" value="B" onchange="checkU(2,'B')"> B &nbsp; By subtracting the static pressure from the total pressure measured in the piezometer</label>
            <label class="mc-opt"><input type="radio" name="u2" value="C" onchange="checkU(2,'C')"> C &nbsp; Using Bernoulli to solve for dynamic pressure from known static pressure values at each position</label>
            <label class="mc-opt"><input type="radio" name="u2" value="D" onchange="checkU(2,'D')"> D &nbsp; We measure the flow rate and cross-sectional area, estimate velocity using Q = Av, then calculate ¬ΩœÅv¬≤</label>
            <div id="uFb2" class="q-feedback"></div>
          </div>
        </div>

        <!-- U3 ‚Äî correct: A -->
        <div class="u-unit">
          <div class="u-unit-body">
            <span class="q-badge q-exp">Explain</span>
            <div class="u-stem">Q3 ‚Äî Pressure‚ÄìVelocity Relationship</div>
            <div class="u-desc">According to Bernoulli's principle and your experimental data, what happens to static pressure as fluid velocity increases through the venturi throat?</div>
            <label class="mc-opt"><input type="radio" name="u3" value="A" onchange="checkU(3,'A')"> A &nbsp; Static pressure decreases as velocity increases</label>
            <label class="mc-opt"><input type="radio" name="u3" value="B" onchange="checkU(3,'B')"> B &nbsp; Static pressure remains constant regardless of velocity</label>
            <label class="mc-opt"><input type="radio" name="u3" value="C" onchange="checkU(3,'C')"> C &nbsp; Static pressure increases proportionally to velocity</label>
            <label class="mc-opt"><input type="radio" name="u3" value="D" onchange="checkU(3,'D')"> D &nbsp; Static pressure fluctuates randomly</label>
            <div id="uFb3" class="q-feedback"></div>
          </div>
        </div>

        <!-- U4 ‚Äî correct: C -->
        <div class="u-unit">
          <div class="u-unit-body">
            <span class="q-badge q-obs">Observe</span>
            <div class="u-stem">Q4 ‚Äî Ideal Total Pressure</div>
            <div class="u-desc">In an ideal venturi meter with no losses, the total pressure (static + dynamic) should:</div>
            <label class="mc-opt"><input type="radio" name="u4" value="A" onchange="checkU(4,'A')"> A &nbsp; Decrease continuously from inlet to outlet</label>
            <label class="mc-opt"><input type="radio" name="u4" value="B" onchange="checkU(4,'B')"> B &nbsp; Increase from inlet to throat, then decrease to outlet</label>
            <label class="mc-opt"><input type="radio" name="u4" value="C" onchange="checkU(4,'C')"> C &nbsp; Remain constant at all three positions ‚Äî inlet, throat, and outlet</label>
            <label class="mc-opt"><input type="radio" name="u4" value="D" onchange="checkU(4,'D')"> D &nbsp; Be highest at the throat where velocity is maximum</label>
            <div id="uFb4" class="q-feedback"></div>
          </div>
        </div>

        <!-- U5 ‚Äî correct: B -->
        <div class="u-unit">
          <div class="u-unit-body">
            <span class="q-badge q-prd">Predict</span>
            <div class="u-stem">Q5 ‚Äî Coefficient of Discharge</div>
            <div class="u-desc">The coefficient of discharge C<sub>d</sub> in a venturi meter is typically less than 1.0 because:</div>
            <label class="mc-opt"><input type="radio" name="u5" value="A" onchange="checkU(5,'A')"> A &nbsp; The piezometer readings are systematically too high</label>
            <label class="mc-opt"><input type="radio" name="u5" value="B" onchange="checkU(5,'B')"> B &nbsp; Real flow experiences friction, boundary layers, and viscous effects not captured by the ideal equation</label>
            <label class="mc-opt"><input type="radio" name="u5" value="C" onchange="checkU(5,'C')"> C &nbsp; The rotameter overestimates the actual flow rate</label>
            <label class="mc-opt"><input type="radio" name="u5" value="D" onchange="checkU(5,'D')"> D &nbsp; Bernoulli's equation overestimates pressure differences</label>
            <div id="uFb5" class="q-feedback"></div>
          </div>
        </div>

        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:20px;">
          <button class="btn-back" onclick="goTo(2)"><span class="arr">‚Üê</span> Back</button>
          <button class="btn-proceed" style="margin-top:0;" onclick="goTo(4)">Move to deep understanding <span class="arr">‚Üí</span></button>
        </div>
      </div>
    </div><!-- /s3 -->

    <!-- ‚ïê‚ïê SLIDE 4 ‚Äî DEEP UNDERSTANDING (CFD) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="slide" id="s4">
      <div class="slide-body">
        <div class="slide-h">Deep Understanding</div>
        <div class="slide-lead">Three CFD simulations at 7 L/min, each paired with a question. These show what is happening <em>everywhere</em> in the flow field .</div>

        <div class="quiz-meta">
          <span class="q-prog-label" id="qprog-lbl">0 of 3 answered</span>
          <div class="q-prog-track"><div class="q-prog-fill" id="qprog-fill" style="width:0%"></div></div>
        </div>

        <!-- CFD 1: STATIC PRESSURE ‚Äî correct: C -->
        <div class="cfd-unit">
          <div class="cfd-unit-header">
            <h3>Static pressure field</h3>
            <p>Blue = lowest (most negative) static pressure; red = highest. The colour gradient shows the full continuous pressure field that your three tapping points sample at just three locations.</p>
          </div>
          <div class="cfd-img-area">
            <img src="https://github.com/Nidiana/LabsDiscussion/raw/main/Venturi_Effect/StaticField7LPM.png" alt="CFD static pressure contour 7 LPM" loading="lazy">
          </div>
          <div class="cfd-observe">
            <strong>Observe:</strong> P‚ÇÅ (inlet) sits in a deep red region ‚Äî high static pressure in the wide, slow-moving section. P‚ÇÇ (throat) is where the colour shifts to blue, the lowest static pressure in the whole field. P‚ÇÉ (outlet) shows a colour between blue and red spectrum ‚Äî incomplete pressure recovery due to friction in the diverging section. The pressure varies <em>continuously</em> between the taps; your piezometers capture only three samples of this curve. Also note that near the converging and diverging transitions the contours are not perfectly parallel ‚Äî this is why taps must be placed in the straight, fully developed sections.
          </div>
          <div class="cfd-question">
            <span class="q-badge q-exp">Explain</span>
            <div class="q-stem">Q1 ‚Äî Why can we apply Bernoulli between these three positions, even though  Bernoulli is violated near the walls?</div>
            <div class="q-context">Consider where P‚ÇÅ, P‚ÇÇ and P‚ÇÉ are located and what the static pressure contours tell you about those specific regions.</div>
            <label class="mc-opt"><input type="radio" name="q1" value="A" onchange="checkQ(1,'A')"> A &nbsp; Because Bernoulli is valid everywhere in liquid flows at these velocities</label>
            <label class="mc-opt"><input type="radio" name="q1" value="B" onchange="checkQ(1,'B')"> B &nbsp; Because pressure losses only occur at the throat, not at the tap positions</label>
            <label class="mc-opt"><input type="radio" name="q1" value="C" onchange="checkQ(1,'C')"> C &nbsp; Because the taps are in straight sections where the pressure field is uniform across the cross-section ‚Äî viscous effects are confined to a thin wall layer and the wall pressure equals the cross-sectional mean</label>
            <label class="mc-opt"><input type="radio" name="q1" value="D" onchange="checkQ(1,'D')"> D &nbsp; Because the piezometers measure total pressure, which is conserved even with viscosity</label>
            <div id="fb1" class="q-feedback"></div>
          </div>
        </div>

        <!-- CFD 2: VELOCITY ‚Äî correct: B -->
        <div class="cfd-unit">
          <div class="cfd-unit-header">
            <h3>Velocity magnitude field</h3>
            <p>Blue = lowest velocity; red = highest. Velocity is <em>not uniform</em> across the cross-section ‚Äî it is highest on the centreline and falls to zero at the wall. This non-uniformity is the physical origin of C<sub>d</sub> &lt; 1.</p>
          </div>
          <div class="cfd-img-area">
            <img src="https://github.com/Nidiana/LabsDiscussion/raw/main/Venturi_Effect/VelField7LPM.png" alt="CFD velocity magnitude contour 7 LPM" loading="lazy">
          </div>
          <div class="cfd-observe">
            <strong>Observe:</strong> The blue region clinging to the wall is the <em>boundary layer</em> ‚Äî fluid slowed almost to zero by the no-slip condition. At the throat, where the geometry is narrowest, this slow wall layer means the effective flow area is slightly smaller than the geometric 78.5 mm¬≤. Bernoulli-based theory assumes plug flow (uniform velocity across the section), so it predicts a higher Q than is actually achieved ‚Äî which is exactly why C<sub>d</sub> &lt; 1. Also observe the diverging section: the boundary layer thickens as the flow decelerates against rising pressure. If the diverging angle were too steep, this layer would separate entirely from the wall, destroying pressure recovery.
          </div>
          <div class="cfd-question">
            <span class="q-badge q-exp">Explain</span>
            <div class="q-stem">Q2 ‚Äî The actual flow rate in your experiment was less than the theoretical Bernoulli prediction. What does this velocity field tell you is the physical reason?</div>
            <div class="q-context">Look at the colour distribution across the throat cross-section, not just along the centreline.</div>
            <label class="mc-opt"><input type="radio" name="q2" value="A" onchange="checkQ(2,'A')"> A &nbsp; The fluid slows down inside the throat due to increased pressure</label>
            <label class="mc-opt"><input type="radio" name="q2" value="B" onchange="checkQ(2,'B')"> B &nbsp; The no-slip condition at the wall creates a boundary layer of slow fluid, reducing the effective flow area below 79 mm¬≤ ‚Äî so real Q is always less than Q = A‚ÇÇ √ó vÃÑ assumes</label>
            <label class="mc-opt"><input type="radio" name="q2" value="C" onchange="checkQ(2,'C')"> C &nbsp; The rotameter under-reads at high velocities</label>
            <label class="mc-opt"><input type="radio" name="q2" value="D" onchange="checkQ(2,'D')"> D &nbsp; Bernoulli over-predicts the pressure difference between inlet and throat</label>
            <div id="fb2" class="q-feedback"></div>
          </div>
        </div>

        <!-- CFD 3: TOTAL PRESSURE ‚Äî correct: D -->
        <div class="cfd-unit">
          <div class="cfd-unit-header">
            <h3>Total pressure field</h3>
            <p>Blue = lowest total pressure; red = highest. If Bernoulli held everywhere, this map would be a single uniform colour. It is not ‚Äî understanding <em>where</em> it varies and why is the key engineering insight of this experiment.</p>
          </div>
          <div class="cfd-img-area">
            <img src="https://github.com/Nidiana/LabsDiscussion/raw/main/Venturi_Effect/TotalField7LPM.png" alt="CFD total pressure contour 7 LPM" loading="lazy">
          </div>
          <div class="cfd-observe">
            <strong>Observe:</strong> The core of the flow is largely uniform in colour ‚Äî total pressure is approximately conserved there, consistent with the Bernoulli approximation. Near the walls the colour shifts toward blue: viscosity is converting mechanical energy to heat in the boundary layer, in direct violation of Bernoulli's inviscid assumption. The total pressure also decreases slightly from inlet to outlet even in the core ‚Äî this is the real friction loss your experiment measured as P‚ÇÅ<sub>total</sub> ‚àí P‚ÇÉ<sub>total</sub>. Crucially, the three tap positions sample the core where this loss is small between adjacent taps ‚Äî which is why the Bernoulli approximation is usable for your measurements despite the field not being truly inviscid.
          </div>
          <div class="cfd-question">
            <span class="q-badge q-prd">Predict</span>
            <div class="q-stem">Q3 ‚Äî A designer proposes reducing the diverging section length by half to make the venturi more compact. Based on what you see in the velocity and total pressure fields, what is the risk?</div>
            <div class="q-context">Think about what happens to the boundary layer in a decelerating flow when the angle becomes steeper, and what that would do to the total pressure field and pressure recovery.</div>
            <label class="mc-opt"><input type="radio" name="q3" value="A" onchange="checkQ(3,'A')"> A &nbsp; No risk ‚Äî a shorter diffuser simply means the pressure recovers faster</label>
            <label class="mc-opt"><input type="radio" name="q3" value="B" onchange="checkQ(3,'B')"> B &nbsp; The throat velocity would increase, improving measurement sensitivity</label>
            <label class="mc-opt"><input type="radio" name="q3" value="C" onchange="checkQ(3,'C')"> C &nbsp; The Cd value would increase toward 1.0 because the venturi is shorter</label>
            <label class="mc-opt"><input type="radio" name="q3" value="D" onchange="checkQ(3,'D')"> D &nbsp; The boundary layer in the diverging section would be more likely to separate from the wall, creating a recirculation zone ‚Äî total pressure loss would increase sharply and pressure recovery would be severely reduced</label>
            <div id="fb3" class="q-feedback"></div>
          </div>
        </div>


        <div class="completion-banner" id="completion-banner">
          <div class="completion-icon">üéâ</div>
          <div class="completion-title">Activity complete!</div>
          <div class="completion-msg">
            Well done ‚Äî you have recorded your measurements, analysed the Bernoulli principle,
            explored the full flow field through CFD, and answered all eight questions.
            You can revisit any section using the numbered steps above or the back button below.
          </div>
        </div>

        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:20px;">
          <button class="btn-back" onclick="goTo(3)"><span class="arr">‚Üê</span> Back</button>
        </div>
      </div>
    </div><!-- /s4 -->

  </div><!-- /slides-viewport -->
</div><!-- /wizard -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
/* ‚ïê‚ïê‚ïê PHYSICS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const D1=0.020, D2=0.010, D3=0.020;
const A1=Math.PI*(D1/2)**2, A2=Math.PI*(D2/2)**2, A3=Math.PI*(D3/2)**2;
const G=9.81, RHO=1000, MU=0.001;
const C_ST='#1a4e8c', C_DY='#bf360c', C_TO='#263238';

let trials=[], trialCount=0, charts={};
let quizAnswers={}, answeredQs=new Set();
let uAnswers={},   answeredUs=new Set();

/* ‚ïê‚ïê‚ïê BOOT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.addEventListener('DOMContentLoaded',()=>{
  addTrial();
  updateProgress();
  updateUProgress();
});

/* ‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function goTo(n){
  document.querySelectorAll('.slide').forEach(s=>{
    if(s.classList.contains('active')){
      s.classList.remove('active');
      s.classList.add('exit');
      setTimeout(()=>s.classList.remove('exit'),340);
    }
  });
  document.getElementById('s'+n).classList.add('active');
  document.getElementById('s'+n).scrollTop=0;
  for(let i=1;i<=4;i++){
    const p=document.getElementById('sp'+i);
    p.classList.remove('active','done');
    if(i<n) p.classList.add('done');
    else if(i===n) p.classList.add('active');
  }
}

/* ‚ïê‚ïê‚ïê TRIALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function addTrial(){
  trialCount++;
  const tc=document.createElement('div');
  tc.className='trial-card'; tc.id='tc-'+trialCount;
  tc.innerHTML=`
  <div class="trial-row-head">
    <span class="trial-label">Trial ${trialCount}</span>
    ${trialCount>1?`<button class="btn-rm" onclick="removeTrial(${trialCount})">Remove</button>`:''}
  </div>
  <div class="fields-grid">
    <div class="fld f-p1"><label>h‚ÇÅ Inlet (mmH‚ÇÇO)</label>
      <input type="number" id="h1-${trialCount}" step="1" placeholder="e.g. 305" inputmode="decimal" oninput="watchTrial(${trialCount})"></div>
    <div class="fld f-p2"><label>h‚ÇÇ Throat (mmH‚ÇÇO)</label>
      <input type="number" id="h2-${trialCount}" step="1" placeholder="e.g. 152" inputmode="decimal" oninput="watchTrial(${trialCount})"></div>
    <div class="fld f-p3"><label>h‚ÇÉ Outlet (mmH‚ÇÇO)</label>
      <input type="number" id="h3-${trialCount}" step="1" placeholder="e.g. 287" inputmode="decimal" oninput="watchTrial(${trialCount})"></div>
    <div class="fld f-fl"><label>Flow rate (L/min)</label>
      <input type="number" id="fl-${trialCount}" step="0.1" placeholder="e.g. 9.0" inputmode="decimal" oninput="watchTrial(${trialCount})"></div>
  </div>`;
  document.getElementById('trials-wrap').appendChild(tc);
  watchTrial(trialCount);
}
function removeTrial(id){ document.getElementById('tc-'+id)?.remove(); checkBtn(); }
function watchTrial(id){
  const vals=['h1','h2','h3','fl'].map(k=>{
    const el=document.getElementById(k+'-'+id); return el?parseFloat(el.value):NaN;
  });
  document.getElementById('tc-'+id)?.classList.toggle('complete',vals.every(v=>!isNaN(v)&&v>=0));
  checkBtn();
}
function checkBtn(){
  let any=false;
  for(let i=1;i<=trialCount;i++) if(document.getElementById('tc-'+i)?.classList.contains('complete')){ any=true; break; }
  document.getElementById('btn1').disabled=!any;
}

/* ‚ïê‚ïê‚ïê ANALYSIS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function runAnalysis(){
  trials=[];
  for(let i=1;i<=trialCount;i++){
    if(!document.getElementById('tc-'+i)) continue;
    const get=k=>parseFloat(document.getElementById(k+'-'+i)?.value);
    const [h1,h2,h3,fl]=['h1','h2','h3','fl'].map(get);
    if([h1,h2,h3,fl].some(v=>isNaN(v)||v<0)) continue;
    const [h1m,h2m,h3m]=[h1,h2,h3].map(v=>v/1000);
    const Q=fl/60000;
    const [v1,v2,v3]=[A1,A2,A3].map(a=>Q/a);
    const Ps=[h1m,h2m,h3m].map(h=>RHO*G*h);
    const Pd=[v1,v2,v3].map(v=>0.5*RHO*v*v);
    const Pt=Ps.map((p,i)=>p+Pd[i]);
    const dP=Ps[0]-Ps[1];
    const Qth=dP>0?A2*Math.sqrt(2*dP/(RHO*(1-(A2/A1)**2))):NaN;
    const Cd=Qth&&Qth>0?Q/Qth:NaN;
    trials.push({n:i,h1,h2,h3,fl,Q,v1,v2,v3,
                 Ps1:Ps[0],Ps2:Ps[1],Ps3:Ps[2],
                 Pd1:Pd[0],Pd2:Pd[1],Pd3:Pd[2],
                 Pt1:Pt[0],Pt2:Pt[1],Pt3:Pt[2],
                 Cd,Re:RHO*v2*D2/MU,Qth});
  }
  if(!trials.length){ alert('Complete at least one trial first.'); return; }
  populateSel(); drawPressureChart(); buildFlowChart();
  goTo(2);
}
function populateSel(){
  const sel=document.getElementById('trialSel'); sel.innerHTML='';
  trials.forEach((t,i)=>{ const o=document.createElement('option'); o.value=i; o.textContent=`Trial ${t.n}  (${t.fl.toFixed(1)} L/min)`; sel.appendChild(o); });
}
function drawPressureChart(){
  if(charts.p){try{charts.p.destroy();}catch(e){}}
  const t=trials[parseInt(document.getElementById('trialSel').value)||0]; if(!t) return;
  charts.p=new Chart(document.getElementById('pressureChart').getContext('2d'),{
    type:'bar',
    data:{
      labels:['P‚ÇÅ  Inlet','P‚ÇÇ  Throat','P‚ÇÉ  Outlet'],
      datasets:[
        {label:'Static (œÅgh)',data:[t.Ps1,t.Ps2,t.Ps3],backgroundColor:C_ST+'C0',stack:'s'},
        {label:'Dynamic (¬ΩœÅv¬≤)',data:[t.Pd1,t.Pd2,t.Pd3],backgroundColor:C_DY+'C0',stack:'s'},
        {label:'Total',type:'line',data:[t.Pt1,t.Pt2,t.Pt3],borderColor:C_TO,borderWidth:2.5,
         pointRadius:7,pointBackgroundColor:'#fff',pointBorderColor:C_TO,pointBorderWidth:2.5,
         backgroundColor:'transparent',fill:false}
      ]
    },
    options:{responsive:true,plugins:{
      legend:{position:'bottom',labels:{boxWidth:12,font:{size:13,family:'Inter'}}},
      title:{display:true,text:`Trial ${t.n} ¬∑ ${t.fl.toFixed(1)} L/min ¬∑ Cd=${isNaN(t.Cd)?'‚Äî':t.Cd.toFixed(3)}`,color:'#546e7a',font:{size:13,family:'Inter'}}
    },scales:{
      y:{stacked:true,title:{display:true,text:'Pressure (Pa)',font:{size:13,family:'Inter'}},grid:{color:'#e0e6da'}},
      x:{grid:{color:'#e0e6da'}}
    }}
  });
}
function buildFlowChart(){
  if(charts.f){try{charts.f.destroy();}catch(e){}}
  charts.f=new Chart(document.getElementById('flowChart').getContext('2d'),{
    type:'bar',
    data:{
      labels:trials.map(t=>`T${t.n}`),
      datasets:[
        {label:'Theoretical (Bernoulli)',data:trials.map(t=>isNaN(t.Qth)?0:+(t.Qth*60000).toFixed(2)),backgroundColor:'#A8C8E8',borderColor:C_ST,borderWidth:1.5},
        {label:'Actual (measured)',data:trials.map(t=>+t.fl.toFixed(2)),backgroundColor:C_ST+'BB',borderColor:'#1A3F6F',borderWidth:1.5}
      ]
    },
    options:{responsive:true,plugins:{
      legend:{position:'bottom',labels:{boxWidth:12,font:{size:13,family:'Inter'}}},
      tooltip:{callbacks:{afterBody(items){const t=trials[items[0].dataIndex];return isNaN(t.Cd)?[]:[`Cd = ${t.Cd.toFixed(3)}`,`Loss = ${((1-t.Cd)*100).toFixed(1)}%`];}}}
    },scales:{
      y:{beginAtZero:true,title:{display:true,text:'Flow rate (L/min)',font:{size:13,family:'Inter'}},grid:{color:'#e0e6da'}},
      x:{grid:{color:'#e0e6da'}}
    }}
  });
}

/* ‚ïê‚ïê‚ïê UNDERSTANDING QUIZ (Slide 3) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Correct: U1=C  U2=D  U3=A  U4=C  U5=B              */
const U_CORRECT={1:'C',2:'D',3:'A',4:'C',5:'B'};
const U_FB={
  1:{
    C:`<strong>‚úì Correct.</strong> Real fluids have viscosity ‚Äî friction converts mechanical energy to heat as fluid moves through the pipe. Total pressure therefore decreases from inlet to outlet. The drop in total pressure between P‚ÇÅ and P‚ÇÉ is the direct experimental measure of these viscous losses.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: C.</strong> Real fluids experience viscous friction, which dissipates mechanical energy as heat. Total pressure (static + dynamic) therefore decreases from inlet to outlet. This is the fundamental difference between real flow and the inviscid ideal assumed by Bernoulli.`
  },
  2:{
    D:`<strong>‚úì Correct.</strong> The piezometer only measures static pressure (the tapping hole is perpendicular to flow, so it does not sense kinetic energy). To find dynamic pressure ¬ΩœÅv¬≤, we use the measured flow rate Q and the known cross-sectional area A to calculate v = Q/A at each position, then compute ¬ΩœÅv¬≤. Total pressure is then P<sub>static</sub> + ¬ΩœÅv¬≤.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: D.</strong> Piezometers measure static pressure only. Dynamic pressure must be computed from velocity, obtained from Q = Av using the measured flow rate and the known pipe cross-section.`
  },
  3:{
    A:`<strong>‚úì Correct.</strong> Bernoulli's equation states that static + dynamic pressure ‚âà constant. As fluid accelerates through the throat (continuity forces higher velocity in the smaller area), dynamic pressure (¬ΩœÅv¬≤) increases. For the total to stay approximately constant, static pressure must fall. This is exactly what your piezometer readings confirm: h‚ÇÇ &lt; h‚ÇÅ.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: A.</strong> By Bernoulli's principle, as velocity increases the dynamic pressure rises, so static pressure must fall to conserve total energy along the streamline. The piezometer at the throat reads lower than at the inlet precisely because the fluid is moving faster there.`
  },
  4:{
    C:`<strong>‚úì Correct.</strong> In ideal (inviscid, incompressible, steady) flow Bernoulli states P + ¬ΩœÅv¬≤ = constant along a streamline (horizontal venturi). Although static and dynamic pressure each change, their sum ‚Äî total pressure ‚Äî is conserved at all positions. Any measured decrease in your experiment is the signature of real viscous losses.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: C.</strong> Bernoulli is a statement of energy conservation for ideal flow. In a horizontal frictionless venturi, P + ¬ΩœÅv¬≤ = constant everywhere, so total pressure is the same at all three positions regardless of how static and dynamic components trade off.`
  },
  5:{
    B:`<strong>‚úì Correct.</strong> The ideal Q<sub>ideal</sub> is derived assuming inviscid, plug flow. Real flow has a boundary layer (no-slip at the wall creates slow fluid near the wall), viscous shear, and minor turbulent losses. These reduce the effective throat area below 78.5 mm¬≤ and dissipate energy ‚Äî so Q<sub>actual</sub> &lt; Q<sub>ideal</sub>, giving C<sub>d</sub> &lt; 1.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: B.</strong> C<sub>d</sub> &lt; 1 because real fluids are viscous. The boundary layer at the throat wall reduces effective flow area, and viscous shear dissipates energy ‚Äî effects not captured by the ideal Bernoulli derivation.`
  }
};
function checkU(qNum,answer){
  if(answeredUs.has(qNum)) return;
  answeredUs.add(qNum);
  uAnswers[qNum]={a:answer,ts:new Date().toISOString()};
  document.querySelectorAll(`input[name="u${qNum}"]`).forEach(r=>{r.disabled=true;r.closest('.mc-opt').classList.add('locked');});
  const fb=document.getElementById('uFb'+qNum);
  const ok=answer===U_CORRECT[qNum];
  fb.innerHTML=ok?(U_FB[qNum][answer]||U_FB[qNum].def):(U_FB[qNum][answer]||U_FB[qNum].def);
  fb.className='q-feedback '+(ok?'fb-ok':'fb-err')+' show';
  updateUProgress();
  fb.scrollIntoView({behavior:'smooth',block:'nearest'});
}
function updateUProgress(){
  const n=answeredUs.size;
  document.getElementById('uprog-lbl').textContent=`${n} of 5 answered`;
  document.getElementById('uprog-fill').style.width=`${(n/5)*100}%`;
}

/* ‚ïê‚ïê‚ïê DEEP UNDERSTANDING QUIZ (Slide 4) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Correct: Q1=C  Q2=B  Q3=D                           */
const CORRECT={1:'C',2:'B',3:'D'};
const FB={
  1:{
    C:`<strong>‚úì Correct.</strong> The static pressure CFD shows that in straight, fully developed sections (where P‚ÇÅ, P‚ÇÇ and P‚ÇÉ are tapped), the pressure contours are uniform across the cross-section ‚Äî wall pressure equals the cross-sectional mean. Viscous losses are concentrated in the thin boundary layer at the wall, but the core flow satisfies Bernoulli. Tap locations were <em>designed</em> to exploit this.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: C.</strong> Bernoulli assumes inviscid flow, violated near the walls. However, the tap positions are in straight, fully developed sections where pressure is uniform across the cross-section and the boundary layer is thin ‚Äî making Bernoulli a valid approximation between those specific points.`
  },
  2:{
    B:`<strong>‚úì Correct.</strong> The velocity field shows the no-slip condition in action: zero at the wall, maximum on the centreline. This boundary layer of slow fluid reduces the effective flow area below the geometric 79 mm¬≤. Because Bernoulli theory assumes plug flow, it predicts a higher Q than is actually achieved. The ratio Q_actual / Q_ideal = Cd, and the boundary layer is exactly why Cd &lt; 1.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: B.</strong> The velocity contour shows slow fluid near the wall (boundary layer) that reduces the effective throat area below 79 mm¬≤. Real Q is therefore less than the plug-flow prediction ‚Äî that is the physical meaning of Cd &lt; 1.`
  },
  3:{
    D:`<strong>‚úì Correct.</strong> In the diverging section, pressure rises in the flow direction ‚Äî an <em>adverse pressure gradient</em>. This is inherently destabilising for the boundary layer. A steeper (shorter) diffuser angle intensifies this gradient, making boundary-layer separation more likely: the flow reverses near the wall, a recirculation zone forms, total pressure loss rises sharply, and static pressure recovery at P‚ÇÉ is destroyed. The long gentle diverging section is a precision engineering decision, not arbitrary geometry.`,
    def:`<strong>‚úó Incorrect ‚Äî correct answer: D.</strong> A shorter diverging section means a steeper adverse pressure gradient. The boundary layer cannot remain attached, separates from the wall, and creates a recirculation zone ‚Äî total pressure loss increases dramatically and pressure recovery fails. The long diverging section exists specifically to prevent this.`
  }
};
function checkQ(qNum,answer){
  if(answeredQs.has(qNum)) return;
  answeredQs.add(qNum);
  quizAnswers[qNum]={a:answer,ts:new Date().toISOString()};
  document.querySelectorAll(`input[name="q${qNum}"]`).forEach(r=>{r.disabled=true;r.closest('.mc-opt').classList.add('locked');});
  const fb=document.getElementById('fb'+qNum);
  const ok=answer===CORRECT[qNum];
  fb.innerHTML=ok?(FB[qNum][answer]||FB[qNum].def):(FB[qNum][answer]||FB[qNum].def);
  fb.className='q-feedback '+(ok?'fb-ok':'fb-err')+' show';
  updateProgress();
  fb.scrollIntoView({behavior:'smooth',block:'nearest'});
}
function updateProgress(){
  const n=answeredQs.size;
  document.getElementById('qprog-lbl').textContent=`${n} of 3 answered`;
  document.getElementById('qprog-fill').style.width=`${(n/3)*100}%`;
  if(n===3){
    const banner=document.getElementById('completion-banner');
    if(banner){ banner.classList.add('show'); banner.scrollIntoView({behavior:'smooth',block:'nearest'}); }
  }
}



</script>
  <div class="copyright">
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />
            &copy; 2025 Nidiana Rosado Hau, University of Sheffield
  </div>
</body>
</html>

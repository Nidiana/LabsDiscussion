<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venturi Meter Analysis Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
        }
        .specs {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #ddd;
        }
        .tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        .tab.active {
            background: #667eea;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .data-entry {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .trial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .trial-header h3 {
            margin: 0;
            color: #667eea;
        }
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 13px;
        }
        input, textarea {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 15px;
            transition: border-color 0.3s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }
        .add-trial-btn, .analyze-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: background 0.3s;
        }
        .add-trial-btn:hover, .analyze-btn:hover {
            background: #5568d3;
        }
        .question-section {
            background: #fff9e6;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .question-section h3 {
            margin-top: 0;
            color: #f57c00;
        }
        .question {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border: 1px solid #ffe082;
        }
        .question h4 {
            margin-top: 0;
            color: #e65100;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        canvas {
            max-width: 100%;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .result-card h4 {
            margin-top: 0;
            font-size: 14px;
            opacity: 0.9;
        }
        .result-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        .insight {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .insight h4 {
            margin-top: 0;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåä Venturi Meter</h1>
        <p class="subtitle">Data Collection and Analysis for Bernoulli's Principle Investigation</p>
        
        <div class="specs">
            <strong>Venturi Specifications:</strong> Inlet √ò 20 mm (A‚ÇÅ = 314 mm¬≤) | Throat √ò 10 mm (A‚ÇÇ = 79 mm¬≤) | Outlet √ò 20 mm (A‚ÇÉ = 314 mm¬≤)
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('data')">üìä Data Entry</button>
            <button class="tab" onclick="showTab('analysis')">üìà Analysis & Graphs</button>
            <button class="tab" onclick="showTab('quiz')">‚úÖ Multiple Choice Quiz</button>
        </div>

        <!-- DATA ENTRY TAB -->
        <div id="data" class="tab-content active">
            <h2>Experimental Data Collection</h2>
            <p>Enter your measurements for at least 3-5 different flow rates. Record piezometer heights (in cm) and flow rate (in L/min).</p>
            
            <div id="trials-container"></div>
            
            <button class="add-trial-btn" onclick="addTrial()">+ Add New Trial</button>
            <button class="analyze-btn" onclick="analyzeData()">Analyze Data & Generate Graphs</button>
        </div>

        <!-- ANALYSIS TAB -->
        <div id="analysis" class="tab-content">
            <h2>Data Analysis & Visualization</h2>
            
            <div id="summary-table"></div>
            
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">Pressure Distribution (Static, Dynamic & Total)</h3>
                    <div>
                        <label for="trialSelector" style="margin-right: 10px;">Select Trial:</label>
                        <select id="trialSelector" onchange="updatePressureDistribution()" style="padding: 8px; border: 2px solid #667eea; border-radius: 5px; font-size: 14px;">
                        </select>
                    </div>
                </div>
                <p style="color: #666; font-size: 14px;">Stacked bars show how Static + Dynamic = Total Pressure at each position.</p>
                <canvas id="pressureChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3>Total Pressure Along Venturi (All Trials)</h3>
                <p style="color: #666; font-size: 14px;">Compare total pressure behavior across all trials. Ideally constant (Bernoulli), but friction and measurement errors cause variations.</p>
                <canvas id="totalPressureChart"></canvas>
            </div>
            
            <div id="insights-container"></div>
        </div>

        <!-- QUIZ TAB -->
        <div id="quiz" class="tab-content">
            <h2>Multiple Choice Quiz</h2>
            <p>Test your understanding of the venturi meter principles based on your experimental data!</p>
            
            <div class="question-section">
                <!-- Question 1 -->
                <div class="question">
                    <h4>Question 1: Total Pressure Behavior</h4>
                    <p>Based on your experimental results, how did the total pressure behave along the Venturi tube (from the inlet to the outlet)?</p>
                    <div style="margin: 15px 0;">
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q1" value="A" onchange="checkAnswer(1, 'A')"> A) üîª The total pressure decreased along the Venturi for most flow rates
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q1" value="B" onchange="checkAnswer(1, 'B')"> B) üî∫ The total pressure increased along the Venturi for most flow rates
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q1" value="C" onchange="checkAnswer(1, 'C')"> C) ‚öñÔ∏è The total pressure changed irregularly, with no consistent trend related to flow rate
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q1" value="D" onchange="checkAnswer(1, 'D')"> D) ‚ùì I cannot draw a clear conclusion, possibly due to measurement errors or inconsistent readings
                        </label>
                    </div>
                    <div id="feedback1" style="display: none; margin-top: 15px;"></div>
                </div>

                <!-- Question 2 -->
                <div class="question">
                    <h4>Question 2: Dynamic Pressure Calculation</h4>
                    <p>In this experiment the static pressure is measured by reading the water column in the piezometer and using Œîp = œÅgh. How is the dynamic pressure calculated?</p>
                    <div style="margin: 15px 0;">
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q2" value="A" onchange="checkAnswer(2, 'A')"> A) It is not possible to calculate; we need a pitot tube to measure it directly
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q2" value="B" onchange="checkAnswer(2, 'B')"> B) We measure the flow rate, the cross-sectional area, and estimate the velocity using Q = Av, then calculate ¬ΩœÅv¬≤
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q2" value="C" onchange="checkAnswer(2, 'C')"> C) By subtracting the static pressure from the total pressure measured in the piezometer
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q2" value="D" onchange="checkAnswer(2, 'D')"> D) Using the Bernoulli equation to solve for dynamic pressure from known static pressure values
                        </label>
                    </div>
                    <div id="feedback2" style="display: none; margin-top: 15px;"></div>
                </div>

                <!-- Question 3 -->
                <div class="question">
                    <h4>Question 3: Pressure-Velocity Relationship</h4>
                    <p>According to Bernoulli's principle and your experimental data, what happens to static pressure as fluid velocity increases through the venturi throat?</p>
                    <div style="margin: 15px 0;">
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q3" value="A" onchange="checkAnswer(3, 'A')"> A) Static pressure increases proportionally to velocity
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q3" value="B" onchange="checkAnswer(3, 'B')"> B) Static pressure decreases as velocity increases
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q3" value="C" onchange="checkAnswer(3, 'C')"> C) Static pressure remains constant regardless of velocity
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q3" value="D" onchange="checkAnswer(3, 'D')"> D) Static pressure fluctuates randomly
                        </label>
                    </div>
                    <div id="feedback3" style="display: none; margin-top: 15px;"></div>
                </div>

                <!-- Question 4 -->
                <div class="question">
                    <h4>Question 4: Total Pressure Behavior</h4>
                    <p>In an ideal venturi meter (no losses), the total pressure (static + dynamic) should:</p>
                    <div style="margin: 15px 0;">
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q4" value="A" onchange="checkAnswer(4, 'A')"> A) Increase from inlet to throat, then decrease to outlet
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q4" value="B" onchange="checkAnswer(4, 'B')"> B) Decrease continuously from inlet to outlet
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q4" value="C" onchange="checkAnswer(4, 'C')"> C) Remain constant at all three positions (inlet, throat, outlet)
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q4" value="D" onchange="checkAnswer(4, 'D')"> D) Be highest at the throat where velocity is maximum
                        </label>
                    </div>
                    <div id="feedback4" style="display: none; margin-top: 15px;"></div>
                </div>

                <!-- Question 5 -->
                <div class="question">
                    <h4>Question 5: Coefficient of Discharge</h4>
                    <p>The coefficient of discharge (Cd) in a venturi meter is typically less than 1.0 because:</p>
                    <div style="margin: 15px 0;">
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q5" value="A" onchange="checkAnswer(5, 'A')"> A) The rotameter overestimates the actual flow rate
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q5" value="B" onchange="checkAnswer(5, 'B')"> B) Real flow experiences friction, boundary layers, and viscous effects
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q5" value="C" onchange="checkAnswer(5, 'C')"> C) Bernoulli's equation overestimates pressure differences
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q5" value="D" onchange="checkAnswer(5, 'D')"> D) The piezometer readings are systematically too high
                        </label>
                    </div>
                    <div id="feedback5" style="display: none; margin-top: 15px;"></div>
                </div>

                <!-- Question 6 -->
                <div class="question">
                    <h4>Question 6: Static Pressure Distribution</h4>
                    <p>If the piezometer height at the throat (h‚ÇÇ) is lower than at the inlet (h‚ÇÅ), this indicates that:</p>
                    <div style="margin: 15px 0;">
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q6" value="A" onchange="checkAnswer(6, 'A')"> A) The flow rate has decreased at the throat
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q6" value="B" onchange="checkAnswer(6, 'B')"> B) Static pressure has decreased due to increased velocity at the throat
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q6" value="C" onchange="checkAnswer(6, 'C')"> C) There is a measurement error in the piezometer readings
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q6" value="D" onchange="checkAnswer(6, 'D')"> D) The venturi meter is not functioning properly
                        </label>
                    </div>
                    <div id="feedback6" style="display: none; margin-top: 15px;"></div>
                </div>

                <!-- Question 7 -->
                <div class="question">
                    <h4>Question 7: Pressure Recovery</h4>
                    <p>Why doesn't the outlet pressure fully recover to the inlet pressure value in a real venturi meter?</p>
                    <div style="margin: 15px 0;">
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q7" value="A" onchange="checkAnswer(7, 'A')"> A) The continuity equation fails at the outlet
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q7" value="B" onchange="checkAnswer(7, 'B')"> B) Dynamic pressure is lost due to turbulence at the outlet
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q7" value="C" onchange="checkAnswer(7, 'C')"> C) Energy is lost due to friction and viscous effects throughout the venturi
                        </label>
                        <label style="display: block; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; cursor: pointer;">
                            <input type="radio" name="q7" value="D" onchange="checkAnswer(7, 'D')"> D) The outlet diameter is too large compared to the throat
                        </label>
                    </div>
                    <div id="feedback7" style="display: none; margin-top: 15px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        const D1 = 0.020;
        const D2 = 0.010;
        const D3 = 0.020;
        const A1 = Math.PI * Math.pow(D1/2, 2);
        const A2 = Math.PI * Math.pow(D2/2, 2);
        const A3 = Math.PI * Math.pow(D3/2, 2);
        const g = 9.81;
        const rho = 1000;
        const mu = 0.001;

        let trials = [];
        let trialCount = 0;
        let charts = {};
        let quizAnswers = {};
        let answeredQuestions = new Set();

        window.onload = function() {
            addTrial();
            loadSavedAnswers();
        };

        function loadSavedAnswers() {
            const saved = localStorage.getItem('venturi_quiz_answers');
            if (saved) {
                quizAnswers = JSON.parse(saved);
                // Restore radio button selections and disable answered questions
                for (let qNum in quizAnswers) {
                    const radio = document.querySelector(`input[name="q${qNum}"][value="${quizAnswers[qNum].answer}"]`);
                    if (radio) {
                        radio.checked = true;
                        disableQuestion(qNum);
                    }
                    answeredQuestions.add(parseInt(qNum));
                }
            }
        }

        function disableQuestion(questionNum) {
            // Disable all radio buttons for this question
            const radios = document.querySelectorAll(`input[name="q${questionNum}"]`);
            radios.forEach(radio => {
                radio.disabled = true;
                radio.parentElement.style.opacity = '0.6';
                radio.parentElement.style.cursor = 'not-allowed';
            });
        }

        function saveAnswer(questionNum, answer) {
            const timestamp = new Date().toISOString();
            quizAnswers[questionNum] = {
                answer: answer,
                timestamp: timestamp
            };
            localStorage.setItem('venturi_quiz_answers', JSON.stringify(quizAnswers));
        }

        function exportAnswers() {
            if (Object.keys(quizAnswers).length === 0) {
                alert('No answers to export yet! Please answer at least one question.');
                return;
            }

            // Get the last answer timestamp for filename
            let lastTimestamp = '';
            if (quizAnswers[7]) {
                lastTimestamp = quizAnswers[7].timestamp;
            } else {
                // Use most recent answer if Q7 not answered yet
                let latestTime = null;
                for (let qNum in quizAnswers) {
                    const time = new Date(quizAnswers[qNum].timestamp);
                    if (!latestTime || time > latestTime) {
                        latestTime = time;
                        lastTimestamp = quizAnswers[qNum].timestamp;
                    }
                }
            }

            // Extract time in HHMM format
            const date = new Date(lastTimestamp);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const timeStr = hours + minutes;

            // Create .dat file content in CSV format
            let content = 'Timestamp,Question,Answer\n';
            
            for (let qNum = 1; qNum <= 7; qNum++) {
                if (quizAnswers[qNum]) {
                    content += `${quizAnswers[qNum].timestamp},Q${qNum},${quizAnswers[qNum].answer}\n`;
                } else {
                    content += `Not answered,Q${qNum},N/A\n`;
                }
            }

            // Create blob and download
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Venturi${timeStr}.dat`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function clearAnswers() {
            if (confirm('Are you sure you want to clear all saved answers? This cannot be undone.')) {
                quizAnswers = {};
                answeredQuestions.clear();
                localStorage.removeItem('venturi_quiz_answers');
                // Re-enable and uncheck all radio buttons
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                    radio.disabled = false;
                    radio.parentElement.style.opacity = '1';
                    radio.parentElement.style.cursor = 'pointer';
                });
                // Hide all feedback
                for (let i = 1; i <= 7; i++) {
                    const feedbackDiv = document.getElementById(`feedback${i}`);
                    if (feedbackDiv) feedbackDiv.style.display = 'none';
                }
                alert('All answers cleared!');
            }
        }

        window.onload = function() {
            addTrial();
        };

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function addTrial() {
            trialCount++;
            const trialDiv = document.createElement('div');
            trialDiv.className = 'data-entry';
            trialDiv.id = `trial-${trialCount}`;
            trialDiv.innerHTML = `
                <div class="trial-header">
                    <h3>Trial ${trialCount}</h3>
                    ${trialCount > 1 ? `<button class="delete-btn" onclick="deleteTrial(${trialCount})">Delete</button>` : ''}
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>h‚ÇÅ - Inlet (cm)</label>
                        <input type="number" id="h1-${trialCount}" step="0.1" placeholder="e.g., 30.5">
                    </div>
                    <div class="input-group">
                        <label>h‚ÇÇ - Throat (cm)</label>
                        <input type="number" id="h2-${trialCount}" step="0.1" placeholder="e.g., 15.2">
                    </div>
                    <div class="input-group">
                        <label>h‚ÇÉ - Outlet (cm)</label>
                        <input type="number" id="h3-${trialCount}" step="0.1" placeholder="e.g., 28.7">
                    </div>
                    <div class="input-group">
                        <label>Flow Rate (L/min)</label>
                        <input type="number" id="flow-${trialCount}" step="0.1" placeholder="e.g., 5.0">
                    </div>
                </div>
            `;
            document.getElementById('trials-container').appendChild(trialDiv);
        }

        function deleteTrial(id) {
            document.getElementById(`trial-${id}`).remove();
        }

        function analyzeData() {
            trials = [];
            
            for (let i = 1; i <= trialCount; i++) {
                const trialDiv = document.getElementById(`trial-${i}`);
                if (!trialDiv) continue;
                
                const h1 = parseFloat(document.getElementById(`h1-${i}`).value);
                const h2 = parseFloat(document.getElementById(`h2-${i}`).value);
                const h3 = parseFloat(document.getElementById(`h3-${i}`).value);
                const flow = parseFloat(document.getElementById(`flow-${i}`).value);
                
                if (isNaN(h1) || isNaN(h2) || isNaN(h3) || isNaN(flow)) continue;
                
                const h1_m = h1 / 100;
                const h2_m = h2 / 100;
                const h3_m = h3 / 100;
                const Q = flow / 60000;
                
                const v1 = Q / A1;
                const v2 = Q / A2;
                const v3 = Q / A3;
                
                const P1_static = rho * g * h1_m;
                const P2_static = rho * g * h2_m;
                const P3_static = rho * g * h3_m;
                
                const P1_dynamic = 0.5 * rho * Math.pow(v1, 2);
                const P2_dynamic = 0.5 * rho * Math.pow(v2, 2);
                const P3_dynamic = 0.5 * rho * Math.pow(v3, 2);
                
                const P1_total = P1_static + P1_dynamic;
                const P2_total = P2_static + P2_dynamic;
                const P3_total = P3_static + P3_dynamic;
                
                const Q_theoretical = A2 * Math.sqrt(2 * g * (h1_m - h2_m) * Math.pow(A1/A2, 2) / (Math.pow(A1/A2, 2) - 1));
                const Cd = Q / Q_theoretical;
                
                const Re = (rho * v2 * D2) / mu;
                
                trials.push({
                    trial: i,
                    h1, h2, h3, flow,
                    v1, v2, v3,
                    P1_static, P2_static, P3_static,
                    P1_dynamic, P2_dynamic, P3_dynamic,
                    P1_total, P2_total, P3_total,
                    Cd, Re
                });
            }
            
            if (trials.length === 0) {
                alert('Please enter data for at least one trial!');
                return;
            }
            
            createSummaryTable();
            createCharts();
            generateInsights();
            showTab('analysis');
        }

        function createSummaryTable() {
            let html = '<h3>Summary of Calculations</h3><table><thead><tr>';
            html += '<th>Trial</th><th>Flow<br>(L/min)</th>';
            html += '<th>v‚ÇÅ<br>(m/s)</th><th>v‚ÇÇ<br>(m/s)</th><th>v‚ÇÉ<br>(m/s)</th>';
            html += '<th>P‚ÇÅ total<br>(Pa)</th><th>P‚ÇÇ total<br>(Pa)</th><th>P‚ÇÉ total<br>(Pa)</th>';
            html += '<th>Cd</th><th>Re</th></tr></thead><tbody>';
            
            trials.forEach(t => {
                html += `<tr>
                    <td>${t.trial}</td>
                    <td>${t.flow.toFixed(1)}</td>
                    <td>${t.v1.toFixed(3)}</td>
                    <td>${t.v2.toFixed(3)}</td>
                    <td>${t.v3.toFixed(3)}</td>
                    <td>${t.P1_total.toFixed(0)}</td>
                    <td>${t.P2_total.toFixed(0)}</td>
                    <td>${t.P3_total.toFixed(0)}</td>
                    <td>${t.Cd.toFixed(3)}</td>
                    <td>${t.Re.toFixed(0)}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            document.getElementById('summary-table').innerHTML = html;
        }

        function createCharts() {
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};
            
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
            
            const selector = document.getElementById('trialSelector');
            selector.innerHTML = '';
            trials.forEach((trial, idx) => {
                const option = document.createElement('option');
                option.value = idx;
                option.textContent = `Trial ${trial.trial} (${trial.flow.toFixed(1)} L/min)`;
                selector.appendChild(option);
            });
            
            updatePressureDistribution();
            
            const ctx2 = document.getElementById('totalPressureChart').getContext('2d');
            charts.totalPressure = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: ['Inlet (Pos 1)', 'Throat (Pos 2)', 'Outlet (Pos 3)'],
                    datasets: trials.map((trial, idx) => ({
                        label: `Trial ${trial.trial} (${trial.flow.toFixed(1)} L/min)`,
                        data: [trial.P1_total, trial.P2_total, trial.P3_total],
                        borderColor: colors[idx % colors.length],
                        backgroundColor: colors[idx % colors.length] + '20',
                        tension: 0.3,
                        borderWidth: 3,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }))
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const trial = trials[context.datasetIndex];
                                    return `Loss from inlet: ${(trial.P1_total - context.parsed.y).toFixed(0)} Pa`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            title: { display: true, text: 'Total Pressure (Pa)' },
                            beginAtZero: false
                        }
                    }
                }
            });
        }
        
        function updatePressureDistribution() {
            const selectedIdx = parseInt(document.getElementById('trialSelector').value);
            const trial = trials[selectedIdx];
            
            if (charts.pressure) {
                charts.pressure.destroy();
            }
            
            const ctx = document.getElementById('pressureChart').getContext('2d');
            charts.pressure = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Inlet (Pos 1)', 'Throat (Pos 2)', 'Outlet (Pos 3)'],
                    datasets: [{
                        label: 'Static Pressure',
                        data: [trial.P1_static, trial.P2_static, trial.P3_static],
                        backgroundColor: '#2196f3',
                        stack: 'Stack 0'
                    }, {
                        label: 'Dynamic Pressure',
                        data: [trial.P1_dynamic, trial.P2_dynamic, trial.P3_dynamic],
                        backgroundColor: '#ff5722',
                        stack: 'Stack 0'
                    }, {
                        label: 'Total Pressure',
                        data: [trial.P1_total, trial.P2_total, trial.P3_total],
                        type: 'line',
                        borderColor: '#4caf50',
                        backgroundColor: 'transparent',
                        borderWidth: 4,
                        pointRadius: 8,
                        pointStyle: 'circle',
                        pointBorderWidth: 2,
                        pointBackgroundColor: '#4caf50',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: {
                            display: true,
                            text: `Trial ${trial.trial} - Flow Rate: ${trial.flow.toFixed(1)} L/min`,
                            font: { size: 14 }
                        },
                        tooltip: {
                            callbacks: {
                                footer: function(items) {
                                    const pos = items[0].dataIndex;
                                    const totals = [trial.P1_total, trial.P2_total, trial.P3_total];
                                    const statics = [trial.P1_static, trial.P2_static, trial.P3_static];
                                    const dynamics = [trial.P1_dynamic, trial.P2_dynamic, trial.P3_dynamic];
                                    return [
                                        `Static: ${statics[pos].toFixed(0)} Pa`,
                                        `Dynamic: ${dynamics[pos].toFixed(0)} Pa`,
                                        `Total: ${totals[pos].toFixed(0)} Pa`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            title: { display: true, text: 'Pressure (Pa)' },
                            stacked: true
                        }
                    }
                }
            });
        }

        function generateInsights() {
            const avgCd = trials.reduce((sum, t) => sum + t.Cd, 0) / trials.length;
            const velocityRatio = trials[0].v2 / trials[0].v1;
            
            const avgP2_drop = trials.reduce((sum, t) => sum + ((t.P1_total - t.P2_total) / t.P1_total * 100), 0) / trials.length;
            const avgP3_recovery = trials.reduce((sum, t) => sum + ((t.P3_total - t.P2_total) / (t.P1_total - t.P2_total) * 100), 0) / trials.length;
            
            let html = '<h3>Key Insights from Your Data</h3>';
            

            
            html += `<div class="insight">
                <h4>üî¨ Coefficient of Discharge Analysis</h4>
                <p>Average Cd: <strong>${avgCd.toFixed(3)}</strong> (Range: ${Math.min(...trials.map(t => t.Cd)).toFixed(3)} - ${Math.max(...trials.map(t => t.Cd)).toFixed(3)})</p>
                <p><strong>What does Cd represent?</strong></p>
                <p>Cd = Q<sub>actual</sub> / Q<sub>theoretical</sub></p>
                <p>In venturi meter design, <strong>Cd is conventionally reported based on throat Reynolds number</strong> (Re = œÅv‚ÇÇD‚ÇÇ/Œº), where the throat diameter D‚ÇÇ = 10 mm is used. 
                This is because the throat represents the critical flow condition with highest velocity and lowest pressure.</p>
                <p><strong>Typical Cd values for well-designed venturi meters: 0.95 - 0.99</strong></p>
                <p>The theoretical flow rate assumes ideal Bernoulli conditions (no friction, no boundary layers, inviscid flow). 
            </div>`;
            
            document.getElementById('insights-container').innerHTML = html;
        }

        function checkAnswer(questionNum, answer) {
            // Check if question already answered
            if (answeredQuestions.has(questionNum)) {
                return; // Don't process if already answered
            }
            
            // Mark as answered and disable the question
            answeredQuestions.add(questionNum);
            disableQuestion(questionNum);
            
            // Save the answer with timestamp
            saveAnswer(questionNum, answer);
            
            // Question 1 is observational only - no correct/wrong answer
            if (questionNum === 1) {
                const feedbackDiv = document.getElementById('feedback1');
                let feedback = '';
                
                if (answer === 'A') {
                    feedback = '<div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; border-radius: 5px;"><strong>üìä Your Observation: Total pressure decreased</strong><br>Good observation! In real venturi meters, total pressure typically decreases from inlet to outlet due to friction losses and viscous effects. This represents energy dissipation as heat. Check your "Total Pressure Along Venturi" graph - if your lines show a downward trend, this confirms real-world energy losses. In an ideal venturi (no losses), total pressure would remain constant according to Bernoulli\'s principle, but reality always includes some friction.</div>';
                } else if (answer === 'B') {
                    feedback = '<div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; border-radius: 5px;"><strong>üìä Your Observation: Total pressure increased</strong><br>Interesting observation! This is unusual for a venturi meter. Check your "Total Pressure Along Venturi" graph carefully. If you see an increase, this might indicate: (1) measurement errors in piezometer readings, (2) air bubbles in the system, or (3) miscalculation. In both ideal and real venturi meters, total pressure should either stay constant (ideal) or decrease slightly (real, due to friction). Review your data and measurements to ensure accuracy.</div>';
                } else if (answer === 'C') {
                    feedback = '<div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; border-radius: 5px;"><strong>üìä Your Observation: Total pressure changed irregularly</strong><br>You observed irregular changes in total pressure. This suggests there may be inconsistencies in your measurements or experimental setup. Check your "Total Pressure Along Venturi" graph - you should see either relatively flat lines (approaching ideal behavior) or consistently decreasing lines (typical real behavior). Irregular patterns might indicate: measurement errors, air bubbles, flow instabilities, or calculation mistakes. Review your piezometer readings and ensure consistent flow rates.</div>';
                } else if (answer === 'D') {
                    feedback = '<div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; border-radius: 5px;"><strong>üìä Your Observation: Cannot draw clear conclusion</strong><br>That\'s honest scientific reporting! If your data is unclear, look at your "Total Pressure Along Venturi" graph. For good data, you should see: (1) lines that are relatively flat (ideal case) or (2) lines that consistently decrease from inlet to outlet (real case with friction). If patterns are unclear, consider: checking piezometer readings for errors, ensuring flow was steady during measurements, reviewing calculations, or repeating trials for more consistent data. Sometimes experimental difficulties teach us as much as clear results!</div>';
                }
                
                feedbackDiv.innerHTML = feedback;
                feedbackDiv.style.display = 'block';
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                return;
            }
            
            const correctAnswers = {
                2: 'B',
                3: 'B',
                4: 'C',
                5: 'B',
                6: 'B',
                7: 'C'
            };
            
            const explanations = {
                2: {
                    correct: '<div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 5px;"><strong>‚úì Correct!</strong><br>Exactly right! In this experiment, we measure the flow rate using the rotameter (in L/min), and we know the cross-sectional areas at each position (A‚ÇÅ = 314 mm¬≤, A‚ÇÇ = 79 mm¬≤, A‚ÇÉ = 314 mm¬≤). Using the continuity equation Q = Av, we calculate the velocity at each position: v = Q/A. Once we have the velocity, we can calculate dynamic pressure using the formula: P_dynamic = ¬ΩœÅv¬≤. This is why dynamic pressure is highest at the throat - the smallest area means highest velocity! Check your pressure distribution graph to see how dynamic pressure varies along the venturi.</div>',
                    wrong: '<div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 5px;"><strong>‚úó Incorrect.</strong><br>The correct answer is <strong>B</strong>. While a pitot tube can measure total pressure directly, we don\'t need one for this experiment. We measure the flow rate Q (using the rotameter) and we know the cross-sectional area A at each position. Using the continuity equation Q = Av, we calculate velocity: v = Q/A. Then dynamic pressure is calculated using P_dynamic = ¬ΩœÅv¬≤. This is the method your analysis tool uses to calculate the dynamic pressure values shown in your pressure distribution graph. The piezometers only measure static pressure (P = œÅgh), not dynamic pressure.</div>'
                },
                3: {
                    correct: '<div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 5px;"><strong>‚úì Correct!</strong><br>According to Bernoulli\'s principle, as velocity increases, static pressure decreases. This is the fundamental pressure-velocity trade-off. Look at your experimental data: at the throat (where velocity is highest due to the smallest area), the piezometer height h‚ÇÇ is lowest, indicating the lowest static pressure. The total energy (pressure energy + kinetic energy) remains approximately constant.</div>',
                    wrong: '<div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 5px;"><strong>‚úó Incorrect.</strong><br>The correct answer is <strong>B</strong>. According to Bernoulli\'s principle, as velocity increases, static pressure must decrease to conserve energy. Look at your pressure distribution graph: at the throat where the area is smallest (10 mm diameter), velocity is highest and static pressure (piezometer height h‚ÇÇ) is lowest. This inverse relationship between velocity and pressure is the essence of the venturi effect.</div>'
                },
                4: {
                    correct: '<div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 5px;"><strong>‚úì Correct!</strong><br>In an ideal venturi (no friction losses), total pressure should remain constant because energy is conserved. Total pressure = static pressure + dynamic pressure = P + ¬ΩœÅv¬≤. As the fluid accelerates through the throat, static pressure decreases but dynamic pressure increases by the same amount, keeping the sum constant. However, in your experimental data, you likely observed that total pressure at the outlet is slightly less than at the inlet due to real-world friction losses.</div>',
                    wrong: '<div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 5px;"><strong>‚úó Incorrect.</strong><br>The correct answer is <strong>C</strong>. According to Bernoulli\'s equation for ideal flow, total pressure (static + dynamic) should remain constant along the venturi. This represents conservation of energy: P/œÅ + v¬≤/2 + gz = constant. Check your "Total Pressure Along Venturi" graph - ideally the lines should be horizontal, though in reality there\'s some loss due to friction.</div>'
                },
                5: {
                    correct: '<div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 5px;"><strong>‚úì Correct!</strong><br>Cd = Q<sub>actual</sub> / Q<sub>theoretical</sub> is less than 1.0 because real fluids experience viscous effects that ideal Bernoulli theory doesn\'t account for. Friction at the walls creates boundary layers, reducing the effective flow area. Viscosity causes energy dissipation. These non-ideal effects mean the actual flow rate is always slightly less than what ideal theory predicts. Typical Cd values for well-designed venturi meters range from 0.95 to 0.99.</div>',
                    wrong: '<div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 5px;"><strong>‚úó Incorrect.</strong><br>The correct answer is <strong>B</strong>. The coefficient of discharge accounts for the difference between ideal theory (Bernoulli equation) and reality. Real fluids have viscosity, experience friction at the walls, develop boundary layers, and may have minor turbulence - none of which are considered in ideal Bernoulli theory. These effects reduce the actual flow rate below the theoretical prediction, making Cd < 1.0. Check your Cd value in the insights section.</div>'
                },
                6: {
                    correct: '<div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 5px;"><strong>‚úì Correct!</strong><br>Lower piezometer height means lower static pressure (P = œÅgh). At the throat, the cross-sectional area decreases from 314 mm¬≤ to 79 mm¬≤, so by continuity (Q = Av), velocity must increase by a factor of 4. According to Bernoulli\'s principle, this increase in kinetic energy (¬ΩœÅv¬≤) comes from a decrease in pressure energy (P). Your experimental data should show h‚ÇÇ < h‚ÇÅ, demonstrating this pressure-velocity trade-off.</div>',
                    wrong: '<div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 5px;"><strong>‚úó Incorrect.</strong><br>The correct answer is <strong>B</strong>. Piezometer height directly measures static pressure (P = œÅgh). At the throat, the area is smallest (79 mm¬≤ vs 314 mm¬≤ at inlet), so by continuity equation (Q = Av), velocity must be highest. Bernoulli\'s principle tells us that increased velocity means decreased static pressure. Therefore h‚ÇÇ < h‚ÇÅ is exactly what we expect - it\'s proof that Bernoulli\'s principle is working! Look at your pressure distribution graph to see this relationship.</div>'
                },
                7: {
                    correct: '<div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 5px;"><strong>‚úì Correct!</strong><br>In real flow through the venturi, friction between the fluid and pipe walls dissipates energy as heat. Viscous effects in the boundary layer also cause losses. Additionally, in the diverging section, some turbulence may occur. All these effects mean that some mechanical energy is converted to thermal energy and lost. This is why h‚ÇÉ < h‚ÇÅ in your data, and why total pressure at the outlet is less than at the inlet. The difference represents the permanent pressure loss, while (h‚ÇÅ - h‚ÇÉ) tells you how much energy was lost to friction.</div>',
                    wrong: '<div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 5px;"><strong>‚úó Incorrect.</strong><br>The correct answer is <strong>C</strong>. In your experimental data, compare h‚ÇÅ and h‚ÇÉ. You should find that h‚ÇÉ < h‚ÇÅ, meaning the outlet pressure doesn\'t fully recover to inlet pressure. This is because Bernoulli\'s equation assumes no energy losses, but real fluids experience friction with the pipe walls and viscous dissipation. These effects convert mechanical energy to heat, resulting in a permanent pressure loss. The difference (h‚ÇÅ - h‚ÇÉ) represents the total energy lost to friction in your venturi meter.</div>'
                }
            };
            
            const feedbackDiv = document.getElementById(`feedback${questionNum}`);
            const isCorrect = answer === correctAnswers[questionNum];
            
            feedbackDiv.innerHTML = isCorrect ? explanations[questionNum].correct : explanations[questionNum].wrong;
            feedbackDiv.style.display = 'block';
            
            feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // Auto-download when Question 7 is answered
            if (questionNum === 7) {
                setTimeout(() => {
                    exportAnswers();
                }, 1000);
            }
        }
    </script>
</body>
</html>

